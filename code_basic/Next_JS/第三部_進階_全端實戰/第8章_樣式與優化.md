# 第 8 章：樣式與優化 (Styling & Optimization)

寫出能跑的程式碼只是第一步，寫出「跑得快」且「長得漂亮」的應用程式才是專業展現。Next.js 內建了大量優化工具，讓我們輕鬆達到 Google Lighthouse 滿分。

## 8.1 Tailwind CSS 高效開發哲學

Tailwind CSS 是 Utility-first CSS 框架，它與 React Component 的組合是現代前端開發的黃金拍檔。

### 為什麼在 Next.js 用 Tailwind？
1.  **Zero Runtime**：編譯後就是純 CSS，沒有 JS 執行成本。
2.  **Colocation**：樣式直接寫在 HTML class 裡，不用在 `.css` 檔案與 `.tsx` 之間切換。
3.  **自動削除**：沒用到的 class 完全不會打包進去。

### 實戰技巧：`clsx` 與 `tailwind-merge`
處理動態 class 時，推薦使用 `npm i clsx tailwind-merge`。

```tsx
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

// 建立一個 utility function
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

// 使用
<div className={cn("bg-red-500 p-4", isActive && "bg-green-500")}>
  {/* 如果 isActive 為 true，bg-green-500 會正確覆蓋 bg-red-500 */}
</div>
```

---

## 8.2 字型與圖片優化

### next/font
Google Fonts 有隱私與效能問題（因為要向 Google 伺服器請求）。Next.js 的 `next/font` 會在 build time **自動下載字型檔並 self-host**。

```tsx
// app/layout.tsx
import { Inter } from 'next/font/google'

const inter = Inter({ subsets: ['latin'] })

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
  )
}
```
這樣做，字型載入零延遲 (Zero Layout Shift)！

### next/image
傳統 `<img>` 標籤的問題：載入大圖會卡頓、沒有 lazy loading、容易造成版面跳動 (CLS)。
`<Image>` 元件解決了所有問題：

```tsx
import Image from 'next/image'

<Image
  src="/hero.png"
  alt="Hero Image"
  width={800}    // 必須指定原始寬高以防止 CLS
  height={600}
  placeholder="blur" // 自動生成模糊預覽圖
  priority // 設為 true表示這是首屏圖片，優先載入
/>
```
Next.js 會自動把圖片轉檔為 WebP/AVIF 格式，並根據裝置大小提供不同解析度的圖片。

---

## 8.3 Metadata API 與 SEO

在 App Router 中，我們不再使用 `<Head>` 元件，而是用 Metadata API。

### 靜態 Metadata
在 `layout.tsx` 或 `page.tsx` export 一個常數：

```tsx
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: '我的部落格',
  description: '這是關於 Next.js 的技術文章',
  openGraph: {
    images: ['/og-image.png'],
  },
}
```

### 動態 Metadata
針對動態路由（如文章內頁），使用 `generateMetadata`：

```tsx
// app/blog/[slug]/page.tsx
export async function generateMetadata({ params }: Props): Promise<Metadata> {
  // 可以 fetch 資料庫
  const post = await getPost(params.slug)
  
  return {
    title: post.title,
    openGraph: {
      images: [post.coverImage],
    },
  }
}
```

---

## [範例演練]：為專案加入動態社交預覽圖 (OG Image)

Next.js 提供了一個超酷的功能：用程式碼「畫」出 OG Image (`openga-graph-image.tsx`)。

1.  在 `app/blog/[slug]/` 資料夾下建立 `opengraph-image.tsx`。

```tsx
import { ImageResponse } from 'next/og'

export const runtime = 'edge'

export default async function Image({ params }: { params: { slug: string } }) {
  // 這裡也可以 fetch 資料庫拿標題
  const title = params.slug

  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 60,
          background: 'white',
          width: '100%',
          height: '100%',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          color: 'black',
        }}
      >
        部落格文章：{title}
      </div>
    ),
    {
      width: 1200,
      height: 600,
    }
  )
}
```

2.  **驗證**
    部署後，將文章連結貼到 Facebook 或 Twitter，你會發現預覽圖竟然是我們剛剛寫的那個 HTML 樣式，而且上面的文字會隨著 slug 不同而改變！

不再需要請設計師為每一篇文章做圖，Next.js 幫你動態生成。
