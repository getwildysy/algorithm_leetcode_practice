# 1. Docker ç’°å¢ƒå»ºç½®èˆ‡æ¶æ§‹èªçŸ¥

## 1.1. Docker Client/Server æ¶æ§‹èˆ‡ Daemon é‹ä½œåŸç†

### ä»€éº¼æ˜¯ Docker çš„ Client/Server æ¶æ§‹ï¼Ÿ

Docker æ¡ç”¨å…¸å‹çš„ **Client-Server (å®¢æˆ¶ç«¯-ä¼ºæœå™¨)** æ¶æ§‹æ¨¡å¼ï¼Œé€™æ„å‘³è‘—ç•¶ä½ åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ Docker æŒ‡ä»¤æ™‚ï¼Œå¯¦éš›ä¸Šæ˜¯åœ¨èˆ‡ Docker Daemonï¼ˆå®ˆè­·ç¨‹åºï¼‰é€²è¡Œæºé€šã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Client  â”‚  â—„â”€â”€â”€â”€â–º  â”‚  Docker Daemon   â”‚
â”‚  (CLI æŒ‡ä»¤)     â”‚   REST   â”‚  (dockerd)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   API    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Container, Images,    â”‚
                          â”‚ Networks, Volumes     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒçµ„ä»¶èªªæ˜ï¼š**

1. **Docker Client (`docker` CLI)**
   - é€™æ˜¯ä½ åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥çš„ `docker` æŒ‡ä»¤å·¥å…·
   - è² è²¬å°‡ä½¿ç”¨è€…çš„æŒ‡ä»¤è½‰æ›æˆ REST API è«‹æ±‚
   - å¯ä»¥é€£æ¥åˆ°æœ¬åœ°æˆ–é ç«¯çš„ Docker Daemon

2. **Docker Daemon (`dockerd`)**
   - èƒŒæ™¯åŸ·è¡Œçš„æœå‹™ç¨‹åº
   - è² è²¬ç®¡ç†å®¹å™¨ã€æ˜ åƒæª”ã€ç¶²è·¯ã€å„²å­˜å·ç­‰æ‰€æœ‰ Docker ç‰©ä»¶
   - ç›£è½ Docker API è«‹æ±‚ä¸¦åŸ·è¡Œç›¸æ‡‰æ“ä½œ

3. **é€šè¨Šæ–¹å¼**
   - Unix Socket (é è¨­): `/var/run/docker.sock`
   - TCP Socket: å¯è¨­å®šé ç«¯é€£æ¥
   - Named Pipe (Windows): `//./pipe/docker_engine`

### å¯¦éš›é‹ä½œæµç¨‹ç¯„ä¾‹

ç•¶ä½ åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤æ™‚ï¼š

```bash
docker run -d --name my-nginx nginx:latest
```

**èƒŒå¾Œç™¼ç”Ÿçš„äº‹æƒ…ï¼š**

1. **Client è§£ææŒ‡ä»¤**
   ```
   æŒ‡ä»¤: docker run
   åƒæ•¸: -d (detached mode), --name my-nginx
   æ˜ åƒæª”: nginx:latest
   ```

2. **Client å‘ Daemon ç™¼é€ API è«‹æ±‚**
   ```
   POST /containers/create
   {
     "Image": "nginx:latest",
     "name": "my-nginx",
     "Detach": true
   }
   ```

3. **Daemon åŸ·è¡Œæ“ä½œ**
   - æª¢æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ `nginx:latest` æ˜ åƒæª”
   - å¦‚æœæ²’æœ‰ï¼Œå¾ Docker Hub ä¸‹è¼‰
   - å»ºç«‹å®¹å™¨
   - å•Ÿå‹•å®¹å™¨

4. **å›å‚³çµæœçµ¦ Client**
   ```
   Container ID: a1b2c3d4e5f6...
   ```

### é©—è­‰ Docker Daemon ç‹€æ…‹

```bash
# æª¢æŸ¥ Docker Daemon æ˜¯å¦æ­£åœ¨é‹è¡Œ
systemctl status docker

# æŸ¥çœ‹ Docker ç³»çµ±è³‡è¨Šï¼ˆåŒ…å« Server å’Œ Client ç‰ˆæœ¬ï¼‰
docker info

# æŸ¥çœ‹ Docker ç‰ˆæœ¬
docker version
```

**`docker version` è¼¸å‡ºç¯„ä¾‹ï¼š**
```
Client:
 Version:           24.0.7
 API version:       1.43
 Go version:        go1.20.10

Server: Docker Engine - Community
 Engine:
  Version:          24.0.7
  API version:      1.43 (minimum version 1.12)
  Go version:       go1.20.10
```

> ğŸ’¡ **é‡é»æé†’**ï¼šå¦‚æœä½ çœ‹åˆ° "Cannot connect to the Docker daemon" éŒ¯èª¤ï¼Œä»£è¡¨ Docker Daemon æ²’æœ‰é‹è¡Œï¼Œéœ€è¦å…ˆå•Ÿå‹•æœå‹™ï¼š
> ```bash
> sudo systemctl start docker
> ```

---

## 1.2. Linux ä½¿ç”¨è€…æ¬Šé™è¨­å®šï¼ˆNon-root user é…ç½®ï¼‰

### ç‚ºä»€éº¼éœ€è¦é root ä½¿ç”¨è€…åŸ·è¡Œ Dockerï¼Ÿ

é è¨­æƒ…æ³ä¸‹ï¼ŒDocker Daemon éœ€è¦ root æ¬Šé™æ‰èƒ½é‹è¡Œï¼Œé€™æ„å‘³è‘—æ¯æ¬¡åŸ·è¡Œ `docker` æŒ‡ä»¤éƒ½éœ€è¦åŠ ä¸Š `sudo`ï¼š

```bash
# ä¸åŠ  sudo æœƒå‡ºç¾æ¬Šé™éŒ¯èª¤
docker ps
# permission denied while trying to connect to the Docker daemon socket

# å¿…é ˆåŠ  sudo
sudo docker ps
```

**é€™æ¨£åšçš„ç¼ºé»ï¼š**
- æ¯æ¬¡éƒ½è¦è¼¸å…¥å¯†ç¢¼ï¼Œæ“ä½œä¸ä¾¿
- åœ¨è‡ªå‹•åŒ–è…³æœ¬ä¸­éœ€è¦é¡å¤–è™•ç†æ¬Šé™å•é¡Œ
- å¯èƒ½å› å¿˜è¨˜åŠ  `sudo` å°è‡´æŒ‡ä»¤åŸ·è¡Œå¤±æ•—

### è§£æ±ºæ–¹æ¡ˆï¼šå°‡ä½¿ç”¨è€…åŠ å…¥ docker ç¾¤çµ„

Docker å®‰è£æ™‚æœƒå»ºç«‹ä¸€å€‹åç‚º `docker` çš„ Unix ç¾¤çµ„ï¼Œåªè¦å°‡ä½¿ç”¨è€…åŠ å…¥é€™å€‹ç¾¤çµ„ï¼Œå°±èƒ½åœ¨æ²’æœ‰ `sudo` çš„æƒ…æ³ä¸‹åŸ·è¡Œ Docker æŒ‡ä»¤ã€‚

**æ­¥é©Ÿä¸€ï¼šå»ºç«‹ docker ç¾¤çµ„ï¼ˆé€šå¸¸å·²å­˜åœ¨ï¼‰**
```bash
sudo groupadd docker
```

**æ­¥é©ŸäºŒï¼šå°‡ç•¶å‰ä½¿ç”¨è€…åŠ å…¥ docker ç¾¤çµ„**
```bash
# $USER æ˜¯ç’°å¢ƒè®Šæ•¸ï¼Œä»£è¡¨ç•¶å‰ä½¿ç”¨è€…åç¨±
sudo usermod -aG docker $USER

# å¦‚æœè¦åŠ å…¥ç‰¹å®šä½¿ç”¨è€…ï¼ˆä¾‹å¦‚ï¼šjohnï¼‰
sudo usermod -aG docker john
```

**åƒæ•¸èªªæ˜ï¼š**
- `-a` (append): é™„åŠ åˆ°ç¾¤çµ„ï¼Œè€Œä¸æ˜¯æ›¿æ›ç¾æœ‰ç¾¤çµ„
- `-G` (groups): æŒ‡å®šè¦åŠ å…¥çš„ç¾¤çµ„åç¨±

**æ­¥é©Ÿä¸‰ï¼šé‡æ–°ç™»å…¥æˆ–æ›´æ–°ç¾¤çµ„æ¬Šé™**

```bash
# æ–¹æ³• 1: å®Œå…¨ç™»å‡ºå†ç™»å…¥ï¼ˆæœ€å¾¹åº•ï¼‰
logout

# æ–¹æ³• 2: å•Ÿå‹•æ–°çš„ shell sessionï¼ˆè‡¨æ™‚ç”Ÿæ•ˆï¼‰
newgrp docker

# æ–¹æ³• 3: é‡æ–°è¼‰å…¥ç¾¤çµ„ï¼ˆæŸäº›ç³»çµ±å¯ç”¨ï¼‰
su - $USER
```

**æ­¥é©Ÿå››ï¼šé©—è­‰è¨­å®š**

```bash
# ä¸åŠ  sudo åŸ·è¡Œ Docker æŒ‡ä»¤
docker run hello-world

# æŸ¥çœ‹ç•¶å‰ä½¿ç”¨è€…æ‰€å±¬çš„ç¾¤çµ„
groups
# è¼¸å‡ºæ‡‰åŒ…å«: ... docker ...

# æŸ¥çœ‹ docker.sock çš„æ¬Šé™
ls -l /var/run/docker.sock
# è¼¸å‡ºç¯„ä¾‹: srw-rw---- 1 root docker 0 Dec 12 10:00 /var/run/docker.sock
#                              ^^^^^^ 
#                              docker ç¾¤çµ„å¯è®€å¯«
```

### å®‰å…¨æ€§è€ƒé‡

> âš ï¸ **è­¦å‘Š**ï¼šå°‡ä½¿ç”¨è€…åŠ å…¥ `docker` ç¾¤çµ„ç›¸ç•¶æ–¼æˆäºˆè©²ä½¿ç”¨è€… **è¿‘ä¹ root çš„æ¬Šé™**ï¼Œå› ç‚ºï¼š
> 
> - å®¹å™¨å¯ä»¥æ›è¼‰ä¸»æ©Ÿçš„ä»»ä½•ç›®éŒ„ï¼ˆåŒ…æ‹¬ `/`ï¼‰
> - å¯ä»¥ç”¨ `--privileged` æ¨¡å¼å•Ÿå‹•å®¹å™¨ï¼Œç²å¾—å®Œæ•´ç³»çµ±æ¬Šé™
> 
> **ç¯„ä¾‹ï¼šå±éšªæ“ä½œ**
> ```bash
> # æ›è¼‰ä¸»æ©Ÿæ ¹ç›®éŒ„åˆ°å®¹å™¨
> docker run -it -v /:/host ubuntu bash
> # åœ¨å®¹å™¨å…§å¯ä»¥ä¿®æ”¹ä¸»æ©Ÿçš„ä»»ä½•æª”æ¡ˆ
> ```

**æœ€ä½³å¯¦è¸ï¼š**
1. åªåœ¨ä¿¡ä»»çš„é–‹ç™¼ç’°å¢ƒä½¿ç”¨é root åŸ·è¡Œ
2. ç”Ÿç”¢ç’°å¢ƒè€ƒæ…®ä½¿ç”¨ Rootless Docker æˆ– Podman
3. å®šæœŸå¯©æŸ¥æ“æœ‰ docker ç¾¤çµ„æ¬Šé™çš„ä½¿ç”¨è€…æ¸…å–®

```bash
# æŸ¥çœ‹ docker ç¾¤çµ„çš„æ‰€æœ‰æˆå“¡
getent group docker
# è¼¸å‡º: docker:x:999:user1,user2
```

---

## 1.3. å®¹å™¨ (Container) èˆ‡ æ˜ åƒæª” (Image) çš„å±¤ç‹€çµæ§‹ï¼ˆå”¯è®€å±¤èˆ‡è®€å¯«å±¤ï¼‰

### æ˜ åƒæª” (Image) çš„å±¤ç‹€æ¶æ§‹

Docker æ˜ åƒæª”æ¡ç”¨ **Union File System (è¯åˆæª”æ¡ˆç³»çµ±)** æŠ€è¡“ï¼Œç”±å¤šå€‹ã€Œå”¯è®€å±¤ã€å †ç–Šè€Œæˆã€‚æ¯ä¸€å±¤ä»£è¡¨ Dockerfile ä¸­çš„ä¸€å€‹æŒ‡ä»¤ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Container (è®€å¯«å±¤)             â”‚ â† å¯å¯«å…¥è³‡æ–™ï¼Œå®¹å™¨åˆªé™¤å¾Œæ¶ˆå¤±
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 4: COPY app.py /app/     â”‚ â† å”¯è®€å±¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 3: RUN pip install flask â”‚ â† å”¯è®€å±¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: RUN apt-get update    â”‚ â† å”¯è®€å±¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1: FROM ubuntu:22.04     â”‚ â† åŸºç¤æ˜ åƒæª”å±¤ï¼ˆå”¯è®€ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¦éš›ç¯„ä¾‹ï¼šæŸ¥çœ‹æ˜ åƒæª”çš„å±¤ç´šçµæ§‹

**å»ºç«‹ä¸€å€‹ç°¡å–®çš„ Dockerfileï¼š**

```dockerfile
# Layer 1: åŸºç¤æ˜ åƒæª”
FROM ubuntu:22.04

# Layer 2: å®‰è£å¥—ä»¶
RUN apt-get update && apt-get install -y python3

# Layer 3: å®‰è£ pip å¥—ä»¶
RUN apt-get install -y python3-pip

# Layer 4: è¤‡è£½æ‡‰ç”¨ç¨‹å¼
COPY app.py /app/

# Layer 5: è¨­å®šå·¥ä½œç›®éŒ„
WORKDIR /app

# å®¹å™¨å•Ÿå‹•æŒ‡ä»¤ï¼ˆä¸æœƒç”¢ç”Ÿæ–°å±¤ï¼‰
CMD ["python3", "app.py"]
```

**å»ºç½®æ˜ åƒæª”ï¼š**

```bash
docker build -t my-python-app:v1 .
```

**å»ºç½®éç¨‹è¼¸å‡ºï¼ˆè§€å¯Ÿæ¯ä¸€å±¤ï¼‰ï¼š**
```
[1/5] FROM docker.io/library/ubuntu:22.04
[2/5] RUN apt-get update && apt-get install -y python3
[3/5] RUN apt-get install -y python3-pip
[4/5] COPY app.py /app/
[5/5] WORKDIR /app
```

**æŸ¥çœ‹æ˜ åƒæª”çš„å±¤ç´šè³‡è¨Šï¼š**

```bash
# æ–¹æ³• 1: ä½¿ç”¨ docker historyï¼ˆæ¨è–¦ï¼‰
docker history my-python-app:v1

# è¼¸å‡ºç¯„ä¾‹ï¼š
# IMAGE          CREATED         CREATED BY                                      SIZE
# a1b2c3d4e5f6   2 minutes ago   CMD ["python3" "app.py"]                        0B
# b2c3d4e5f6a1   2 minutes ago   WORKDIR /app                                    0B
# c3d4e5f6a1b2   2 minutes ago   COPY app.py /app/                               1.2kB
# d4e5f6a1b2c3   3 minutes ago   RUN /bin/sh -c apt-get install -y python3-pip   45MB
# e5f6a1b2c3d4   5 minutes ago   RUN /bin/sh -c apt-get update && apt-get ...    128MB
# f6a1b2c3d4e5   2 weeks ago     /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B
```

```bash
# æ–¹æ³• 2: ä½¿ç”¨ docker inspectï¼ˆæŸ¥çœ‹è©³ç´° JSON è³‡è¨Šï¼‰
docker inspect my-python-app:v1 --format='{{json .RootFS.Layers}}' | python3 -m json.tool

# è¼¸å‡ºç¯„ä¾‹ï¼š
# [
#     "sha256:3b5df2...",  // ubuntu:22.04 åŸºç¤å±¤
#     "sha256:7c9a1f...",  // apt-get update
#     "sha256:a4d2e8...",  // python3-pip
#     "sha256:f1e6b9...",  // COPY app.py
#     "sha256:d8c7a2..."   // WORKDIR
# ]
```

### å®¹å™¨çš„è®€å¯«å±¤ (Container Layer)

ç•¶ä½ å¾æ˜ åƒæª”å•Ÿå‹•å®¹å™¨æ™‚ï¼ŒDocker æœƒåœ¨æ˜ åƒæª”çš„æ‰€æœ‰å”¯è®€å±¤ã€Œä¹‹ä¸Šã€åŠ å…¥ä¸€å€‹**å¯å¯«å…¥çš„å®¹å™¨å±¤**ã€‚

```bash
# å•Ÿå‹•å®¹å™¨
docker run -d --name test-container my-python-app:v1

# é€²å…¥å®¹å™¨ä¸¦æ–°å¢æª”æ¡ˆ
docker exec -it test-container bash
echo "Hello Docker" > /app/test.txt
exit

# æŸ¥çœ‹å®¹å™¨å±¤çš„è®Šæ›´
docker diff test-container
```

**`docker diff` è¼¸å‡ºç¯„ä¾‹ï¼š**
```
A /app/test.txt              # A = Added (æ–°å¢)
C /app                       # C = Changed (è®Šæ›´)
C /root/.bash_history        # æŒ‡ä»¤æ­·å²è¨˜éŒ„ä¹Ÿè¢«ä¿®æ”¹
```

**è®Šæ›´é¡å‹èªªæ˜ï¼š**
- `A` (Added): æ–°å¢çš„æª”æ¡ˆæˆ–ç›®éŒ„
- `C` (Changed): ä¿®æ”¹çš„æª”æ¡ˆæˆ–ç›®éŒ„
- `D` (Deleted): åˆªé™¤çš„æª”æ¡ˆæˆ–ç›®éŒ„

### Copy-on-Write (å¯«æ™‚è¤‡è£½) æ©Ÿåˆ¶

ç•¶å®¹å™¨éœ€è¦ä¿®æ”¹æ˜ åƒæª”ä¸­çš„æª”æ¡ˆæ™‚ï¼ŒDocker ä½¿ç”¨ **Copy-on-Write (CoW)** ç­–ç•¥ï¼š

1. æª”æ¡ˆåŸæœ¬å­˜åœ¨æ–¼å”¯è®€çš„æ˜ åƒæª”å±¤
2. å®¹å™¨è¦ä¿®æ”¹æ™‚ï¼Œå°‡æ•´å€‹æª”æ¡ˆè¤‡è£½åˆ°å®¹å™¨å±¤
3. åœ¨å®¹å™¨å±¤é€²è¡Œä¿®æ”¹
4. è®€å–æ™‚å„ªå…ˆè®€å–å®¹å™¨å±¤çš„ç‰ˆæœ¬

**ç¯„ä¾‹ï¼šä¿®æ”¹æ˜ åƒæª”ä¸­çš„æ—¢æœ‰æª”æ¡ˆ**

```bash
# å•Ÿå‹•å®¹å™¨
docker run -it --name cow-test ubuntu:22.04 bash

# ä¿®æ”¹ç³»çµ±æª”æ¡ˆï¼ˆåŸæœ¬åœ¨æ˜ åƒæª”å±¤ï¼‰
echo "custom setting" >> /etc/hosts
exit

# æŸ¥çœ‹è®Šæ›´
docker diff cow-test
# è¼¸å‡º: C /etc/hosts  â† æ•´å€‹ hosts æª”æ¡ˆè¢«è¤‡è£½åˆ°å®¹å™¨å±¤
```

### å±¤ç´šå…±äº«èˆ‡å„²å­˜ç©ºé–“å„ªåŒ–

**å¤šå€‹æ˜ åƒæª”å¯ä»¥å…±äº«ç›¸åŒçš„åŸºç¤å±¤ï¼š**

```bash
# å»ºç½®å…©å€‹åŸºæ–¼ç›¸åŒæ˜ åƒæª”çš„æ‡‰ç”¨
docker build -t app1 -f Dockerfile.app1 .
docker build -t app2 -f Dockerfile.app2 .

# å…©å€‹æ˜ åƒæª”å…±äº« ubuntu:22.04 çš„åŸºç¤å±¤
```

**Dockerfile.app1:**
```dockerfile
FROM ubuntu:22.04      # â† å…±äº«å±¤
RUN apt-get update     # â† å…±äº«å±¤ï¼ˆå¦‚æœæŒ‡ä»¤ç›¸åŒï¼‰
COPY app1.py /app/     # â† ç¨ç«‹å±¤
```

**Dockerfile.app2:**
```dockerfile
FROM ubuntu:22.04      # â† å…±äº«å±¤ï¼ˆèˆ‡ app1 ç›¸åŒï¼‰
RUN apt-get update     # â† å…±äº«å±¤ï¼ˆèˆ‡ app1 ç›¸åŒï¼‰
COPY app2.py /app/     # â† ç¨ç«‹å±¤
```

**æŸ¥çœ‹å¯¦éš›å„²å­˜ç©ºé–“ï¼š**

```bash
# æŸ¥çœ‹æ˜ åƒæª”å¤§å°
docker images

# è¼¸å‡ºç¯„ä¾‹ï¼š
# REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
# app1          latest    abc123...      2 minutes ago   150MB
# app2          latest    def456...      1 minute ago    152MB
# ubuntu        22.04     ghi789...      2 weeks ago     77MB

# æŸ¥çœ‹å¯¦éš›ä½”ç”¨çš„ç£ç¢Ÿç©ºé–“
docker system df

# è¼¸å‡ºç¯„ä¾‹ï¼š
# TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE
# Images          3         2         200MB     52MB (26%)  â† å¯¦éš›åªä½” 200MBï¼Œä¸æ˜¯ 379MB
# Containers      2         1         10MB      5MB (50%)
# Local Volumes   0         0         0B        0B
```

> ğŸ’¡ **é‡é»**ï¼š
> - `app1` (150MB) + `app2` (152MB) = 302MB
> - ä½†å¯¦éš›åªä½”ç”¨ **200MB**ï¼Œå› ç‚ºå…±äº«äº† ubuntu:22.04 åŸºç¤å±¤
> - é€™å°±æ˜¯ Docker å±¤ç´šæ¶æ§‹çš„å„²å­˜å„ªå‹¢ï¼

### æœ€ä½³åŒ–å»ºè­°

1. **ç›¡é‡ä½¿ç”¨å®˜æ–¹åŸºç¤æ˜ åƒæª”**
   ```dockerfile
   # å¥½çš„åšæ³•ï¼šä½¿ç”¨å®˜æ–¹æ˜ åƒæª”
   FROM python:3.11-slim
   
   # é¿å…ï¼šè‡ªå·±å¾é ­å»ºç½®
   # FROM ubuntu:22.04
   # RUN apt-get install python3 ...
   ```

2. **åˆä½µ RUN æŒ‡ä»¤æ¸›å°‘å±¤æ•¸**
   ```dockerfile
   # ä¸å¥½ï¼šç”¢ç”Ÿ 3 å±¤
   RUN apt-get update
   RUN apt-get install -y python3
   RUN apt-get install -y python3-pip
   
   # å¥½ï¼šåªç”¢ç”Ÿ 1 å±¤
   RUN apt-get update && \
       apt-get install -y python3 python3-pip && \
       rm -rf /var/lib/apt/lists/*  # æ¸…ç†å¿«å–
   ```

3. **å°‡ç¶“å¸¸è®Šå‹•çš„æŒ‡ä»¤æ”¾åœ¨å¾Œé¢**
   ```dockerfile
   # Layer 1: åŸºç¤ç’°å¢ƒï¼ˆå¾ˆå°‘è®Šå‹•ï¼‰
   FROM python:3.11-slim
   
   # Layer 2: ç³»çµ±å¥—ä»¶ï¼ˆè¼ƒå°‘è®Šå‹•ï¼‰
   RUN apt-get update && apt-get install -y git
   
   # Layer 3: Python å¥—ä»¶ï¼ˆä¸­ç­‰è®Šå‹•ï¼‰
   COPY requirements.txt .
   RUN pip install -r requirements.txt
   
   # Layer 4: æ‡‰ç”¨ç¨‹å¼ç¢¼ï¼ˆç¶“å¸¸è®Šå‹•ï¼‰
   COPY . /app
   ```

é€™æ¨£å¯ä»¥å……åˆ†åˆ©ç”¨ Docker çš„å±¤ç´šå¿«å–æ©Ÿåˆ¶ï¼ŒåŠ é€Ÿå»ºç½®é€Ÿåº¦ï¼
