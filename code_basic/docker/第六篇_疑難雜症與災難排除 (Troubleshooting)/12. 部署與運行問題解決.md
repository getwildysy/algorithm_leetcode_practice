# 12. éƒ¨ç½²èˆ‡é‹è¡Œå•é¡Œè§£æ±º

## 12.1. YAML é…ç½®è¡çªï¼šç•¶ docker-compose åˆä½µæª”æ¡ˆæ™‚çš„ Array èˆ‡ Object è¦†è“‹è¦å‰‡

### YAML åˆä½µè¦å‰‡å›é¡§

ç•¶ä½¿ç”¨å¤šå€‹ Compose æª”æ¡ˆæ™‚ï¼ˆ`docker-compose -f file1.yml -f file2.yml`ï¼‰ï¼ŒDocker Compose æœƒæŒ‰é †åºåˆä½µé…ç½®ï¼Œä½†**é™£åˆ—èˆ‡ç‰©ä»¶çš„åˆä½µè¡Œç‚ºä¸åŒ**ã€‚

```
file1.yml + file2.yml = åˆä½µçµæœ
ï¼ˆåŸºç¤ï¼‰    ï¼ˆè¦†å¯«ï¼‰    ï¼ˆæœ€çµ‚é…ç½®ï¼‰
```

---

### ç‰©ä»¶ (Object) æ·±åº¦åˆä½µ

**file1.ymlï¼š**
```yaml
services:
  app:
    environment:
      DB_HOST: postgres
      DB_PORT: 5432
    labels:
      traefik.enable: "true"
```

**file2.ymlï¼š**
```yaml
services:
  app:
    environment:
      DB_USER: admin  # æ–°å¢æ¬„ä½
      DEBUG: "true"   # æ–°å¢æ¬„ä½
    labels:
      traefik.http.routers.app.rule: "Host(`example.com`)"  # æ–°å¢æ¬„ä½
```

**åˆä½µçµæœï¼š**
```yaml
services:
  app:
    environment:
      DB_HOST: postgres      # â† ä¿ç•™
      DB_PORT: 5432         # â† ä¿ç•™
      DB_USER: admin        # â† æ–°å¢
      DEBUG: "true"         # â† æ–°å¢
    labels:
      traefik.enable: "true"                              # â† ä¿ç•™
      traefik.http.routers.app.rule: "Host(`example.com`)"  # â† æ–°å¢
```

âœ… **ç‰©ä»¶æœƒæ·±åº¦åˆä½µï¼Œä¿ç•™æ‰€æœ‰éµå€¼**

---

### é™£åˆ— (Array) å®Œå…¨æ›¿æ›

**file1.ymlï¼š**
```yaml
services:
  app:
    ports:
      - "80:80"
      - "443:443"
    networks:
      - frontend
      - backend
```

**file2.ymlï¼š**
```yaml
services:
  app:
    ports:
      - "8080:80"  # æƒ³æ–°å¢ port
    networks:
      - traefik-public  # æƒ³æ–°å¢ç¶²è·¯
```

**åˆä½µçµæœï¼š**
```yaml
services:
  app:
    ports:
      - "8080:80"      # â† åªæœ‰é€™å€‹ï¼443 æ¶ˆå¤±äº†ï¼
    networks:
      - traefik-public  # â† åªæœ‰é€™å€‹ï¼frontendã€backend æ¶ˆå¤±äº†ï¼
```

âŒ **é™£åˆ—æœƒå®Œå…¨æ›¿æ›ï¼Œä¸æ˜¯åˆä½µ**

---

### å•é¡Œç¯„ä¾‹ï¼šç”Ÿç”¢ç’°å¢ƒéºå¤±é—œéµé…ç½®

**docker-compose.ymlï¼ˆåŸºç¤ï¼‰ï¼š**
```yaml
services:
  app:
    image: myapp
    ports:
      - "80:80"      # HTTP
      - "443:443"    # HTTPS
    environment:
      NODE_ENV: production
      DB_HOST: postgresè½
    networks:
      - frontend
      - backend
```

**docker-compose.prod.ymlï¼ˆç”Ÿç”¢è¦†å¯«ï¼‰ï¼š**
```yaml
services:
  app:
    ports:
      - "8080:80"  # âŒ æƒ³å°å¤–æš´éœ² 8080ï¼Œä½†å¿˜è¨˜ä¿ç•™ 443
```

**å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒï¼š**
```bash
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# çµæœï¼š
# - åªç›£è½ 8080:80
# - HTTPS (443) æ¶ˆå¤±ï¼
# - æ‰€æœ‰ SSL é€£ç·šå¤±æ•— ğŸ’€
```

---

### è§£æ±ºæ–¹æ¡ˆ

**æ–¹æ¡ˆ 1ï¼šå®Œæ•´é‡å¯«é™£åˆ—**

```yaml
# docker-compose.prod.yml
services:
  app:
    ports:
      - "8080:80"   # æ–°çš„ HTTP port
      - "443:443"   # âœ… ä¿ç•™ HTTPS port
```

**æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ä¸åŒçš„æœå‹™åç¨±**

```yaml
# docker-compose.yml
services:
  app-dev:
    ports:
      - "80:80"

# docker-compose.prod.yml
services:
  app-prod:
    ports:
      - "8080:80"
      - "443:443"
```

**æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ç’°å¢ƒè®Šæ•¸**

```yaml
# docker-compose.yml
services:
  app:
    ports:
      - "${HTTP_PORT:-80}:80"
      - "${HTTPS_PORT:-443}:443"
```

```bash
# .env.prod
HTTP_PORT=8080
HTTPS_PORT=8443
```

---

### é©—è­‰åˆä½µçµæœ

```bash
# æŸ¥çœ‹åˆä½µå¾Œçš„å®Œæ•´é…ç½®
docker-compose -f docker-compose.yml -f docker-compose.prod.yml config

# è¼¸å‡ºåˆ°æª”æ¡ˆæª¢æŸ¥
docker-compose -f docker-compose.yml -f docker-compose.prod.yml config > merged.yml

# æª¢æŸ¥ç‰¹å®šæœå‹™
docker-compose -f docker-compose.yml -f docker-compose.prod.yml config --services

# æŸ¥çœ‹ç‰¹å®šæ¬„ä½
docker-compose -f docker-compose.yml -f docker-compose.prod.yml config | yq '.services.app.ports'
```

---

## 12.2. æ†‘è­‰éŒ¯èª¤ï¼šTraefik ç²å– Let's Encrypt å¤±æ•—çš„å¸¸è¦‹åŸå› 

### å¸¸è¦‹éŒ¯èª¤è¨Šæ¯

```
level=error msg="Unable to obtain ACME certificate for domains..."
level=error msg="challenge failed: HTTP-01 challenge failed"
```

---

### åŸå›  1ï¼šacme.json æ¬Šé™éŒ¯èª¤

**å•é¡Œï¼š**
```bash
ls -l letsencrypt/acme.json
# -rw-r--r-- 1 user user 0 Dec 12 10:00 acme.json  â† æ¬Šé™éŒ¯èª¤ï¼
```

**Traefik æ—¥èªŒï¼š**
```
level=error msg="Error while Marshaling ACME Account: permissions 644 for /letsencrypt/acme.json are too open, please use 600"
```

**è§£æ±ºï¼š**
```bash
# ä¿®æ­£æ¬Šé™
chmod 600 letsencrypt/acme.json

# é©—è­‰
ls -l letsencrypt/acme.json
# -rw------- 1 user user 0 Dec 12 10:00 acme.json  âœ…

# é‡å•Ÿ Traefik
docker-compose restart traefik
```

---

### åŸå›  2ï¼šDNS æœªæ­£ç¢ºæŒ‡å‘ä¼ºæœå™¨

**å•é¡Œï¼š** ç¶²åŸŸçš„ DNS A è¨˜éŒ„æ²’æœ‰æŒ‡å‘ Traefik ä¼ºæœå™¨

**è¨ºæ–·ï¼š**
```bash
# æŸ¥è©¢ç¶²åŸŸçš„ DNS
dig example.com +short

# å¦‚æœè¼¸å‡ºçš„ IP ä¸æ˜¯ä½ çš„ä¼ºæœå™¨ IP â†’ DNS è¨­å®šéŒ¯èª¤

# æ¸¬è©¦å¾å¤–éƒ¨è¨ªå•
curl -I http://example.com

# Connection refused â†’ DNS æˆ–é˜²ç«ç‰†å•é¡Œ
```

**è§£æ±ºï¼š**
1. åœ¨ DNS æä¾›å•†è¨­å®š A è¨˜éŒ„ï¼š
   ```
   example.com     â†’  123.456.789.0  (ä½ çš„ä¼ºæœå™¨ IP)
   www.example.com â†’  123.456.789.0
   ```

2. ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆå¯èƒ½éœ€è¦ 10-60 åˆ†é˜ï¼‰

3. é©—è­‰ï¼š
   ```bash
   dig example.com +short
   # 123.456.789.0  âœ…
   ```

---

### åŸå›  3ï¼šPort 80 è¢«ä½”ç”¨æˆ–é˜²ç«ç‰†å°é–

**å•é¡Œï¼š** Let's Encrypt HTTP Challenge éœ€è¦ Port 80

**è¨ºæ–·ï¼š**
```bash
# æª¢æŸ¥ Port 80 æ˜¯å¦è¢«ç›£è½
sudo netstat -tuln | grep :80

# å¦‚æœæ²’æœ‰è¼¸å‡º â†’ Port 80 æ²’æœ‰ç›£è½

# æª¢æŸ¥ Traefik å®¹å™¨
docker ps | grep traefik

# æª¢æŸ¥ port mapping
docker port traefik
# 80/tcp -> 0.0.0.0:80  âœ…
```

**é˜²ç«ç‰†è¨ºæ–·ï¼š**
```bash
# UFW
sudo ufw status

# å¦‚æœ Port 80 è¢«å°é–ï¼š
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# iptables
sudo iptables -L -n | grep 80

# é–‹æ”¾ port
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT
```

---

### åŸå›  4ï¼šLet's Encrypt Rate Limit

**éŒ¯èª¤è¨Šæ¯ï¼š**
```
too many certificates already issued for exact set of domains
```

**é™åˆ¶ï¼š**
- æ¯å€‹åŸŸåæ¯é€±æœ€å¤š 50 å¼µæ†‘è­‰
- æ¯å€‹å¸³è™Ÿæ¯å°æ™‚æœ€å¤š 300 å¼µæ†‘è­‰

**è§£æ±ºï¼š**

**1. ä½¿ç”¨ Staging ç’°å¢ƒæ¸¬è©¦**

```yaml
services:
  traefik:
    command:
      # ä½¿ç”¨ Let's Encrypt Staging API
      - "--certificatesresolvers.letsencrypt.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory"
```

**2. æª¢æŸ¥å·²ç™¼è¡Œçš„æ†‘è­‰**

è¨ªå•ï¼šhttps://crt.sh/?q=example.com

**3. ç­‰å¾…é™åˆ¶é‡ç½®ï¼ˆ1 é€±ï¼‰**

---

### åŸå›  5ï¼šå®¹å™¨å…§éƒ¨æ™‚é–“ä¸æ­£ç¢º

**è¨ºæ–·ï¼š**
```bash
# æª¢æŸ¥å®¹å™¨æ™‚é–“
docker exec traefik date

# æª¢æŸ¥ä¸»æ©Ÿæ™‚é–“
date

# å¦‚æœæ™‚é–“å·®ç•°è¶…é 5 åˆ†é˜ â†’ å•é¡Œ
```

**è§£æ±ºï¼š**
```bash
# åŒæ­¥ä¸»æ©Ÿæ™‚é–“
sudo ntpdate -s time.nist.gov

# æˆ–ä½¿ç”¨ systemd-timesyncd
sudo timedatectl set-ntp true

# é‡å•Ÿ Traefik
docker-compose restart traefik
```

---

### åŸå›  6ï¼šé…ç½®éŒ¯èª¤

**éŒ¯èª¤ 1ï¼šemail æœªè¨­å®š**
```yaml
# âŒ
- "--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json"
# â† ç¼ºå°‘ email

# âœ…
- "--certificatesresolvers.letsencrypt.acme.email=admin@example.com"
```

**éŒ¯èª¤ 2ï¼šstorage è·¯å¾‘éŒ¯èª¤**
```yaml
# âŒ Volume è·¯å¾‘èˆ‡ storage ä¸åŒ¹é…
volumes:
  - ./certs:/certs  # â† æ›è¼‰åˆ° /certs
command:
  - "--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json"  # â† ä½†æŒ‡å®š /letsencrypt

# âœ…
volumes:
  - ./letsencrypt:/letsencrypt
command:
  - "--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json"
```

---

### å®Œæ•´é™¤éŒ¯æµç¨‹

```bash
# 1. æª¢æŸ¥ Traefik æ—¥èªŒ
docker-compose logs traefik | grep -i error

# 2. æª¢æŸ¥ acme.json æ¬Šé™
ls -l letsencrypt/acme.json

# 3. æª¢æŸ¥ DNS
dig example.com +short

# 4. æ¸¬è©¦ HTTP è¨ªå•
curl -I http://example.com

# 5. æª¢æŸ¥é˜²ç«ç‰†
sudo ufw status

# 6. é©—è­‰é…ç½®
docker-compose config | grep acme

# 7. æŸ¥çœ‹ acme.json å…§å®¹
cat letsencrypt/acme.json | jq '.'

# 8. æ‰‹å‹•è§¸ç™¼æ†‘è­‰ç”³è«‹ï¼ˆé‡å•Ÿ Traefikï¼‰
docker-compose restart traefik

# 9. å³æ™‚æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f traefik
```

---

## 12.3. è³‡æºè€—ç›¡ï¼šå¦‚ä½•è¨­å®š CPU/Memory Limit é˜²æ­¢å–®ä¸€æœå‹™æ‹–å®æ•´å°ä¼ºæœå™¨

### å•é¡Œå ´æ™¯

**ç½é›£æ¡ˆä¾‹ï¼š**
```
æŸå€‹å®¹å™¨è¨˜æ†¶é«”æ´©æ¼
    â†“
ä½”ç”¨æ‰€æœ‰ä¸»æ©Ÿè¨˜æ†¶é«”
    â†“
å…¶ä»–å®¹å™¨è¢« OOM Killer æ®ºæ‰
    â†“
æ•´å°ä¼ºæœå™¨å´©æ½° ğŸ’€
```

---

### è¨­å®šè³‡æºé™åˆ¶

**Docker Compose 3.8+ èªæ³•ï¼š**

```yaml
version: '3.8'

services:
  app:
    image: myapp
    deploy:
      resources:
        limits:
          cpus: '1.5'        # æœ€å¤šä½¿ç”¨ 1.5 å€‹ CPU æ ¸å¿ƒ
          memory: 2G         # æœ€å¤šä½¿ç”¨ 2GB è¨˜æ†¶é«”
        reservations:
          cpus: '0.5'        # ä¿ç•™ 0.5 å€‹ CPU æ ¸å¿ƒ
          memory: 512M       # ä¿ç•™ 512MB è¨˜æ†¶é«”
```

**åƒæ•¸èªªæ˜ï¼š**
- **limits**: ç¡¬é™åˆ¶ï¼Œè¶…éæœƒè¢«ç¯€æµ(CPU)æˆ–æ®ºæ‰(Memory)
- **reservations**: è»Ÿé™åˆ¶ï¼Œä¿è­‰æœ€ä½è³‡æº

---

### CPU é™åˆ¶

**é™åˆ¶ CPU ä½¿ç”¨ç‡ï¼š**

```yaml
services:
  # ç¯„ä¾‹ 1ï¼šé™åˆ¶ä½¿ç”¨ 50% CPU
  app1:
    deploy:
      resources:
        limits:
          cpus: '0.5'  # 1 å€‹ CPU çš„ 50%

  # ç¯„ä¾‹ 2ï¼šé™åˆ¶ä½¿ç”¨ 2 å€‹å®Œæ•´ CPU
  app2:
    deploy:
      resources:
        limits:
          cpus: '2'

  # ç¯„ä¾‹ 3ï¼šé™åˆ¶ä½¿ç”¨ 1.5 å€‹ CPU
  app3:
    deploy:
      resources:
        limits:
          cpus: '1.5'
```

**CPU ä»½é¡ï¼ˆç›¸å°æ¬Šé‡ï¼‰ï¼š**

```yaml
services:
  high-priority:
    deploy:
      resources:
        reservations:
          cpus: '2'  # é«˜å„ªå…ˆç´šï¼Œä¿è­‰ 2 å€‹ CPU

  low-priority:
    deploy:
      resources:
        reservations:
          cpus: '0.25'  # ä½å„ªå…ˆç´šï¼Œä¿è­‰ 0.25 å€‹ CPU
```

---

### Memory é™åˆ¶

**é™åˆ¶è¨˜æ†¶é«”ä½¿ç”¨ï¼š**

```yaml
services:
  app:
    deploy:
      resources:
        limits:
          memory: 512M   # ç¡¬é™åˆ¶ 512MB
        reservations:
          memory: 256M   # ä¿è­‰ 256MB
```

**å–®ä½ï¼š**
- `b`: bytes
- `k`: kilobytes
- `m` æˆ– `M`: megabytes
- `g` æˆ– `G`: gigabytes

**è¨˜æ†¶é«”äº¤æ›è¨­å®šï¼š**

```yaml
services:
  app:
    deploy:
      resources:
        limits:
          memory: 1G
    mem_swappiness: 0  # ç¦æ­¢ä½¿ç”¨ swapï¼ˆ0-100ï¼‰
```

---

### å®Œæ•´ç¯„ä¾‹ï¼šä¸åŒæœå‹™çš„è³‡æºé…ç½®

```yaml
version: '3.8'

services:
  # ========================================
  # å‰ç«¯ï¼ˆéœæ…‹æª”æ¡ˆï¼Œè³‡æºéœ€æ±‚ä½ï¼‰
  # ========================================
  nginx:
    image: nginx:alpine
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M

  # ========================================
  # API ä¼ºæœå™¨ï¼ˆä¸­ç­‰è³‡æºéœ€æ±‚ï¼‰
  # ========================================
  api:
    image: api:latest
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
      restart_policy:
        condition: on-failure
        max_attempts: 3

  # ========================================
  # è³‡æ–™åº«ï¼ˆé«˜è³‡æºéœ€æ±‚ï¼‰
  # ========================================
  postgres:
    image: postgres:15
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G

  # ========================================
  # Redisï¼ˆè¨˜æ†¶é«”å¯†é›†ï¼‰
  # ========================================
  redis:
    image: redis:7-alpine
    deploy:
      resources:
        limits:
          memory: 2G  # åªé™åˆ¶è¨˜æ†¶é«”
        reservations:
          memory: 512M
    command: redis-server --maxmemory 1.5gb --maxmemory-policy allkeys-lru

  # ========================================
  # èƒŒæ™¯ä»»å‹™ï¼ˆå¯è¢«é™æµï¼‰
  # ========================================
  worker:
    image: worker:latest
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.1'
          memory: 128M
      restart_policy:
        condition: on-failure
```

---

### ç›£æ§è³‡æºä½¿ç”¨

**å³æ™‚ç›£æ§ï¼š**

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨è³‡æºä½¿ç”¨
docker stats

# è¼¸å‡ºï¼š
# CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT     MEM %     NET I/O
# abc123...      app       50.23%    512MiB / 1GiB        50.00%    1.2kB / 2.3kB
# def456...      postgres  25.67%    1.5GiB / 4GiB        37.50%    5.6kB / 8.9kB

# åªç›£æ§ç‰¹å®šå®¹å™¨
docker stats app postgres

# æ ¼å¼åŒ–è¼¸å‡º
docker stats --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}"
```

**æ­·å²æ•¸æ“šï¼ˆä½¿ç”¨ cAdvisor + Prometheusï¼‰ï¼š**

```yaml
# monitoring/docker-compose.yml
services:
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    ports:
      - "8080:8080"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro

  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
```

---

### è™•ç†è³‡æºè€—ç›¡

**è¨˜æ†¶é«”ç”¨ç›¡ï¼ˆOOMï¼‰ï¼š**

```bash
# æª¢æŸ¥ OOM äº‹ä»¶
dmesg | grep -i oom

# è¼¸å‡ºç¯„ä¾‹ï¼š
# [12345.678] Out of memory: Kill process 1234 (node) score 800 or sacrifice child
# [12345.679] Killed process 1234 (node) total-vm:4194304kB

# æŸ¥çœ‹è¢«æ®ºæ‰çš„å®¹å™¨
docker ps -a --filter "status=exited"

# æŸ¥çœ‹å®¹å™¨é€€å‡ºåŸå› 
docker inspect <container> | jq '.[0].State'

# è¼¸å‡ºï¼š
# "OOMKilled": true  â† è¢« OOM Killer æ®ºæ‰
```

**è§£æ±ºï¼š**
```yaml
# å¢åŠ è¨˜æ†¶é«”é™åˆ¶
services:
  app:
    deploy:
      resources:
        limits:
          memory: 2G  # å¾ 1G å¢åŠ åˆ° 2G
```

**CPU ç¯€æµï¼š**

```bash
# æŸ¥çœ‹ CPU ç¯€æµçµ±è¨ˆ
docker stats --no-stream

# å¦‚æœ CPU% æ¥è¿‘é™åˆ¶ï¼ˆå¦‚ 100%ï¼‰ï¼Œè€ƒæ…®å¢åŠ é™åˆ¶
```

---

### è‡ªå‹•é‡å•Ÿç­–ç•¥

```yaml
services:
  app:
    deploy:
      resources:
        limits:
          memory: 1G
      restart_policy:
        condition: on-failure  # å¤±æ•—æ™‚é‡å•Ÿ
        delay: 5s              # ç­‰å¾… 5 ç§’
        max_attempts: 3        # æœ€å¤šé‡è©¦ 3 æ¬¡
        window: 120s           # 120 ç§’å…§
```

**restart_policy é¸é …ï¼š**
- `condition`:
  - `none`: ä¸é‡å•Ÿ
  - `on-failure`: å¤±æ•—æ™‚é‡å•Ÿ
  - `any`: ç¸½æ˜¯é‡å•Ÿ
- `delay`: é‡å•Ÿå‰ç­‰å¾…æ™‚é–“
- `max_attempts`: æœ€å¤§é‡è©¦æ¬¡æ•¸
- `window`: åˆ¤æ–·æˆåŠŸçš„æ™‚é–“çª—å£

---

### ç”Ÿç”¢ç’°å¢ƒå»ºè­°

**1. æŒ‰æœå‹™é¡å‹è¨­å®šè³‡æºï¼š**

| æœå‹™é¡å‹ | CPU é™åˆ¶ | Memory é™åˆ¶ | å»ºè­° |
|---------|---------|------------|------|
| Nginx/éœæ…‹ | 0.25-0.5 | 128M-256M | ä½è³‡æºå³å¯ |
| API æœå‹™ | 0.5-2 | 512M-2G | æ ¹æ“šè² è¼‰èª¿æ•´ |
| è³‡æ–™åº« | 1-4 | 2G-8G | é ç•™å……è¶³è³‡æº |
| Redis/å¿«å– | 0.25-1 | 512M-4G | è¦–å¿«å–å¤§å° |
| èƒŒæ™¯ä»»å‹™ | 0.25-1 | 256M-1G | å¯é™æµ |

**2. ç›£æ§èˆ‡å‘Šè­¦ï¼š**

```yaml
# è¨­å®šå‘Šè­¦é–¾å€¼
- è¨˜æ†¶é«”ä½¿ç”¨ > 80%
- CPU ä½¿ç”¨ > 70%
- å®¹å™¨é‡å•Ÿæ¬¡æ•¸ > 3 æ¬¡/å°æ™‚
```

**3. å®šæœŸæª¢æŸ¥ï¼š**

```bash
#!/bin/bash
# resource-check.sh

echo "è³‡æºä½¿ç”¨å ±å‘Š - $(date)"
echo "======================================"

docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}" | head -20

echo ""
echo "è¨˜æ†¶é«”ä½¿ç”¨ > 80% çš„å®¹å™¨ï¼š"
docker stats --no-stream --format "table {{.Name}}\t{{.MemPerc}}" | awk 'NR>1 && $2+0 > 80'

echo ""
echo "CPU ä½¿ç”¨ > 70% çš„å®¹å™¨ï¼š"
docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}" | awk 'NR>1 && $2+0 > 70'
```

é€™æ¨£å¯ä»¥æœ‰æ•ˆé˜²æ­¢è³‡æºè€—ç›¡å°è‡´çš„æœå‹™ä¸­æ–·ï¼

---

## ç¸½çµ

æœ¬ç« ä»‹ç´¹äº†ä¸‰å¤§é¡éƒ¨ç½²èˆ‡é‹è¡Œå•é¡Œçš„è§£æ±ºæ–¹æ¡ˆï¼š

1. **YAML é…ç½®è¡çª**ï¼šç†è§£é™£åˆ—æ›¿æ›èˆ‡ç‰©ä»¶åˆä½µçš„å·®ç•°
2. **SSL æ†‘è­‰å•é¡Œ**ï¼šè¨ºæ–· Let's Encrypt ACME å¤±æ•—çš„å¸¸è¦‹åŸå› 
3. **è³‡æºç®¡ç†**ï¼šè¨­å®š CPU/Memory é™åˆ¶é˜²æ­¢æœå‹™å´©æ½°

æŒæ¡é€™äº›æŠ€å·§å¯ä»¥å¤§å¹…æå‡ Docker éƒ¨ç½²çš„ç©©å®šæ€§èˆ‡å¯é æ€§ï¼
