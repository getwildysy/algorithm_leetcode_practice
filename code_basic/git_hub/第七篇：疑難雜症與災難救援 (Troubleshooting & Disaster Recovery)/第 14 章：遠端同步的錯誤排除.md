# 第 14 章：遠端同步的錯誤排除

在執行 `git push` 或 `git pull` 時，我們經常會遇到紅色的錯誤訊息。這章收集了最常見的幾個「紅字」及其解法。

## 14.1 錯誤一：Updates were rejected (Non-fast-forward)

**訊息**：
```text
! [rejected]        main -> main (fetch first)
error: failed to push some refs to '...'
hint: Updates were rejected because the remote contains work that you do not have locally.
```

**圖解**：
```mermaid
graph TD
    Remote[Remote: C1-C2-C3]
    Local[Local: C1-C2-C4]
    
    note right of Local: 你跟遠端分岔了！\nGit 不知道要把 C4 接在哪裡。
```

**解法**：
1.  **標準解 (Merge)**：`git pull origin main` (產生 Merge Commit)。
2.  **乾淨解 (Rebase)**：`git pull --rebase origin main` (把你的 C4 接在 C3 後面)。

---

## 14.2 錯誤二：Refusing to merge unrelated histories

**訊息**：
`fatal: refusing to merge unrelated histories`

**情境**：
你分別建立了「本機專案」和「GitHub 專案」(且勾選了 "Initialize with README")，現在想把它們接起來。

**解法**：
```bash
git pull origin main --allow-unrelated-histories
```

---

## 14.3 錯誤三：Authentication failed (權限驗證失敗)

**訊息**：
`fatal: Authentication failed for 'https://github.com/...'`

**原因**：
GitHub 已在 2021 年取消 HTTPS 密碼驗證。

**解法 A：Personal Access Token (PAT)**
1.  GitHub Settings -> Developer settings -> Personal access tokens.
2.  Generate new token.
3.  在 Git 詢問密碼時貼上 Token。

**解法 B：SSH Key (強烈推薦)**
1.  產生金鑰：
    ```bash
    ssh-keygen -t ed25519 -C "your@email.com"
    ```
2.  印出公鑰並複製：
    ```bash
    cat ~/.ssh/id_ed25519.pub
    ```
3.  貼到 GitHub Settings -> SSH keys。
4.  **重要：切換網址** (原本是 https 網址，要改用 ssh)：
    ```bash
    git remote set-url origin git@github.com:User/Repo.git
    ```

---

## 14.4 錯誤四：Detached HEAD please tell me who you are

**情境**：
你在 Detached HEAD 狀態下修了 bug，還 commit 了，結果 `git push` 失敗。

**解法**：
你必須幫這些孤兒 Commit 找一個家 (Branch)。
```bash
# 幫目前的 detached HEAD 建立一個新分支
git checkout -b fix-lost-commits

# 現在可以推了
git push origin fix-lost-commits
```

---

## 14.5 錯誤五：Push 檔案過大 (GH001)

**訊息**：
`remote: error: GH001: Large files detected.`

**原因**：單檔超過 100MB。

**解法**：
1.  **移除該檔案** (需從歷史中徹底移除，參考第 15 章)。
2.  **Git LFS**：若必須上傳，請安裝 Git Large File Storage。
    ```bash
    git lfs install
    git lfs track "*.mp4"
    ```
