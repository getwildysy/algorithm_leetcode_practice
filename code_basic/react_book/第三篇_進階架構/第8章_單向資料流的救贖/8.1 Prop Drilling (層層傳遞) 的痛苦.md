# 8.1 Prop Drilling (層層傳遞) 的痛苦

## 本節大綱

### 什麼是 Prop Drilling？
- 定義與概念
- 為什麼會發生？
- 實際案例

### Prop Drilling 的問題
- 程式碼冗長
- 難以維護
- 中間元件的負擔
- 重構困難

### 解決方案比較
- Context API
- 狀態管理庫（Zustand/Redux）
- 組合模式（Composition）

## 學習目標

- [ ] 理解 Prop Drilling 的問題
- [ ] 識別何時需要全域狀態
- [ ] 了解各種解決方案
- [ ] 選擇適合的方案


在 React 中，資料預設是由上而下單向流動的 (Unidirectional Data Flow)。
這意味著，如果一個深層的子元件需要某個資料，你必須把它從最上層的父元件，一層一層傳遞下去。

## 1. 什麼是 Prop Drilling？

就像鑽地機一樣，把資料一層層往下鑽。

```jsx
function App() {
  const [user, setUser] = useState({ name: 'Alice' });
  return <Layout user={user} />; // 1. 傳給 Layout
}

function Layout({ user }) {
  return <Header user={user} />; // 2. Layout 根本不用 user，但為了傳給 Header 還是要接
}

function Header({ user }) {
  return <UserMenu user={user} />; // 3. Header 也不用，繼續傳
}

function UserMenu({ user }) {
  return <div>Welcome, {user.name}</div>; // 4. 終於到了！
}
```

### 問題點
1. **中間人過多**：`Layout` 和 `Header` 被迫接收跟自己無關的 props。
2. **維護困難**：如果 `UserMenu` 突然需要一個新 prop (例如 `logout` 函式)，你得修改整條傳遞鏈上的所有元件。
3. **重構地獄**：移動元件位置時，容易導致 props 斷鏈。

---

## 2. 解決方案

當 Prop Drilling 只有 2-3 層時，這是正常的，不需要特別解決。
但當層數過多 (例如 > 4 層) 或資料被多個不同樹狀分支的元件共用時，我們需要 **全域狀態管理 (Global State Management)**。

常見方案：
1. **Context API** (React 內建，適合低頻更新的狀態，如 Theme, User)。
2. **Redux / Zustand** (適合複雜、高頻更新的業務邏輯)。

## 小結

- **Prop Drilling** 並非完全是壞事，它讓資料流向很明確。
- 只有在「傳遞層級過深」或「中間元件不知情」的情況下，才視為問題。
