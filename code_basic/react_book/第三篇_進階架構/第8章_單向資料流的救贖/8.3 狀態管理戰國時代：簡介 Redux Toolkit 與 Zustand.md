# 8.3 狀態管理戰國時代：簡介 Redux Toolkit 與 Zustand

## 本節大綱

### 狀態管理的演進
- Flux 架構
- Redux 的誕生
- 現代解決方案

### Redux Toolkit 簡介
- 核心概念（Store, Slice, Reducer）
- 基本用法
- RTK Query
- 適用場景

### Zustand 簡介
- 為什麼推薦初學者？
- 簡潔的 API
- 基本用法
- 中間件

### 如何選擇狀態管理方案？
- 專案規模
- 團隊熟悉度
- 學習曲線
- 效能需求

## 學習目標

- [ ] 了解狀態管理的演進
- [ ] 認識 Redux Toolkit
- [ ] 掌握 Zustand 基本用法
- [ ] 能夠選擇適合的方案


如果你的應用很複雜 (例如購物車、儀表板)，Context 的效能問題會讓你頭痛。這時候就需要專業的狀態管理庫。

目前的趨勢：
- **Redux Toolkit (RTK)**：大型企業級專案首選，規範嚴謹，工具強大。
- **Zustand**：輕量級、簡單、效能好，適合中小型專案或極簡主義者。

本章我們選用 **Zustand**，因為它最 React-friendly 且學習曲線最低。

## 1. Redux 的痛點

以前寫 Redux 要寫：Action Types, Action Creators, Reducers, Store, Provider... 寫一個計數器都要開 5 個檔案。雖然 RTK 改進了很多，但對新手來說還是有點重。

## 2. Zustand：極簡主義的救贖

Zustand (德文的「狀態」) 讓我們只需 **Create a Store**，然後在元件中 **Hook it up**。

### 安裝
`npm install zustand`

### Step 1: 建立 Store
```js
// stores/cartStore.js
import { create } from 'zustand';

export const useCartStore = create((set) => ({
  cart: [],
  
  // Action 直接寫在 Store 裡
  addToCart: (product) => set((state) => ({ 
    cart: [...state.cart, product] 
  })),
  
  removeFromCart: (id) => set((state) => ({
    cart: state.cart.filter(item => item.id !== id)
  })),
  
  clearCart: () => set({ cart: [] })
}));
```

### Step 2: 在元件中使用 (Auto Selector)

Context 最大的痛點是「牵一髮動全身」，但 Zustand 支援 **Selector** 機制，只訂閱你需要的資料。

```jsx
function CartCount() {
  // 只有當 cart.length 改變時，這個元件才會 Re-render！
  // 效能比 Context 好非常多
  const count = useCartStore((state) => state.cart.length);
  
  return <span>Items: {count}</span>;
}

function ProductList({ product }) {
  // 取得 action
  const addToCart = useCartStore((state) => state.addToCart);
  
  return <button onClick={() => addToCart(product)}>Add</button>;
}
```

## 3. 為什麼選 Zustand？

1. **不需要 Provider**：不用在 App.js 包一層 `<Provider>`，解決 Wrapper Hell。
2. **效能優化**：透過 Selector 機制，精準控制 Render。
3. **極簡 API**：就是一個 Hook。

## 方案比較

| 特性 | Context API | Zustand | Redux Toolkit |
|------|-------------|---------|---------------|
| 學習曲線 | 低 | 低 | 中-高 |
| 程式碼量 | 中 | 少 | 多 |
| 效能 | 中 | 高 | 高 |
| DevTools | ❌ | ✅ | ✅ |
| 中間件 | ❌ | ✅ | ✅ |
| 適合規模 | 小 | 中-大 | 大 |

## 小結

- 簡單狀態 -> **useState**
- 中等複雜、跨元件 -> **Context API** (適合 User, Theme)
- 複雜邏輯、高頻更新 -> **Zustand** (或 Redux)
