# 5.1 什麼是副作用 (Side Effect)？

在程式設計（特別是 Functional Programming）中，「副作用」是一個核心概念。但在 React 中，它並不一定是壞事，它只是代表「需要跟外部世界溝通」。

## 1. 純函式 (Pure Function) vs. 不純函式

### 純函式
1. **輸入決定輸出**：給一樣的輸入 (Props)，永遠得到一樣的輸出 (JSX)。
2. **無副作用**：不修改外部變數、不發送網路請求、不操作 DOM。

React 的 Component **在渲染過程中** 必須是純函式：

```jsx
// ✅ 純函式
function Greeter({ name }) {
  return <h1>Hello, {name}</h1>;
}
```

### 副作用 (Side Effects)
任何「跳脫」出 React 渲染週期，去影響外部世界的行為。

- **數據請求** (API Fetching)
- **手動修改 DOM** (document.title = '...')
- **訂閱事件** (window.addEventListener)
- **設置計時器** (setTimeout)
- **Console log** (嚴格來說也是，但通常被允許)

---

## 2. 為什麼需要 `useEffect`？

因為 React 的渲染是頻繁且不可預測的。如果你直接在 Component 本體寫副作用，會發生災難。

### ❌ 錯誤示範
```jsx
function BadComponent() {
  // 每次渲染都會執行！
  // 如果這會觸發 state 更新，就會造成「無限迴圈」
  fetch('/api/data').then(data => setData(data));

  return <div>Data</div>;
}
```

### ✅ 正確示範
`useEffect` 是 React 給你的一個安全區，讓你把副作用放進去。
它保證：**「先渲染 UI，畫好之後，再來處理副作用」**。

```jsx
function GoodComponent() {
  useEffect(() => {
    // 這裡的程式碼會在瀏覽器畫好畫面「之後」才執行
    fetch('/api/data').then(data => setData(data));
  }, []); // 依賴陣列控制執行時機

  return <div>Data</div>;
}
```

## 3. 心智模型：同步 (Synchronize)

不要把 `useEffect` 當作 Lifecycle (componentDidMount) 來思考。
請把它當作 **「將元件與外部系統同步」** 的機制。

- **外部系統**：API 伺服器、瀏覽器 API (window)、第三方套件 (Google Maps)。
- **同步**：當 props 或 state 改變時，確保外部系統的狀態也跟著改變。

## 小結

- **渲染邏輯**必須是純淨的 (Calculations)。
- **副作用**是用來改變外部狀態的 (Actions)。
- `useEffect` 是連接 React 純淨世界與外部混亂世界的橋樑。
